# 외계인 스킬 시스템 구현

**생성일:** 2026-01-18
**상태:** 대기 중

## 목표

외계인 캐릭터의 3가지 스킬 구현:
- Q: 이상한 레이저 빔 (기본 공격 대체)
- W: 텔레파시 (체력 흡수)
- E: 순간이동 (랜덤 위치 + 주변 데미지)

## 키 배치

| 키 | 스킬 | 쿨다운 |
|---|---|---|
| Q | 이상한 레이저 빔 | 3초 |
| W | 텔레파시 | 15초 |
| E | 순간이동 | 10초 |

---

## Phase 1: 스킬 시스템 기반 구축

### 1-1. 스킬 시스템 구조 설계
- [ ] Skill 클래스 설계 (name, key, cooldown, isReady, use)
- [ ] SkillManager 클래스 설계 (스킬 등록, 입력 처리, 업데이트)
- [ ] Character에 SkillManager 연동

### 1-2. 쿨다운 시스템
- [ ] 쿨다운 타이머 구현 (lastUsedTime + cooldown)
- [ ] isReady() 메서드 구현
- [ ] 쿨다운 중 스킬 사용 불가 처리

### 1-3. 스킬 입력 처리
- [ ] Q, W, E 키 입력 감지 (input.js 수정)
- [ ] 키 입력 → 해당 스킬 발동 연결
- [ ] 기존 Space 기본 공격 제거

### 1-4. 스킬 UI
- [ ] 화면 하단에 스킬 아이콘 표시 (Q, W, E)
- [ ] 쿨다운 진행 상황 표시 (어둡게 + 남은 시간)
- [ ] 사용 가능 시 하이라이트

### 테스트
- [ ] 각 키 입력이 정상 감지되는지 확인
- [ ] 쿨다운이 정상 작동하는지 확인
- [ ] UI가 쿨다운 상태를 정확히 표시하는지 확인

---

## Phase 2: 이상한 레이저 빔 (Q)

### 2-1. 적 탐지
- [ ] 가장 가까운 적 찾기 (플레이어, 더미 포함)
- [ ] 적이 없으면 마우스 방향 또는 전방으로 발사

### 2-2. 조준 단계 (1초)
- [ ] 스킬 발동 시 조준 상태 진입
- [ ] 플레이어 → 적 방향으로 빨간 선 표시
- [ ] 선이 1초 동안 점점 진해지는 애니메이션
- [ ] 조준 중 플레이어 이동 가능 (방향은 고정)

### 2-3. 발사 단계
- [ ] 1초 후 흰색 두꺼운 레이저 선 표시 (번쩍)
- [ ] 히트스캔: 선과 겹치는 모든 적에게 데미지
- [ ] 레이저 번쩍 효과 (0.1~0.2초)

### 2-4. 서버 동기화
- [ ] 스킬 발동 시 서버에 전송 (방향, 시작 위치)
- [ ] 서버에서 히트스캔 데미지 계산
- [ ] 다른 플레이어에게 레이저 효과 브로드캐스트

### 테스트
- [ ] 가장 가까운 적을 정확히 조준하는지 확인
- [ ] 조준선이 1초 동안 진해지는지 확인
- [ ] 발사 시 히트스캔이 정확히 적중하는지 확인
- [ ] 쿨다운 3초 적용 확인
- [ ] 멀티플레이어에서 다른 플레이어에게 보이는지 확인

---

## Phase 3: 순간이동 (E)

### 3-1. 텔레포트 위치 계산
- [ ] 현재 위치 기준 일정 거리 내 랜덤 위치 선정
- [ ] 맵 경계 체크 (화면 밖으로 이동 방지)
- [ ] 이동 거리 설정 (200~400px 정도?)

### 3-2. 순간이동 효과
- [ ] 시작 위치에 이펙트 (사라지는 효과)
- [ ] 도착 위치에 이펙트 (나타나는 효과)
- [ ] 순간적인 화면 전환 (캐릭터 위치 즉시 변경)

### 3-3. 도착 지점 주변 데미지
- [ ] 기존 기본 공격 코드 활용
- [ ] 도착 위치 기준 범위 데미지
- [ ] 반투명 빨강 원 표시 (기존 공격 효과)

### 3-4. 서버 동기화
- [ ] 순간이동 발동 서버 전송
- [ ] 서버에서 도착 위치 및 데미지 계산
- [ ] 다른 플레이어에게 텔레포트 효과 브로드캐스트

### 테스트
- [ ] 랜덤 위치가 맵 내에 있는지 확인
- [ ] 순간이동 시 위치가 즉시 변경되는지 확인
- [ ] 도착 지점 주변 데미지가 적용되는지 확인
- [ ] 쿨다운 10초 적용 확인
- [ ] 멀티플레이어에서 동기화 확인

---

## Phase 4: 텔레파시 (W)

### 4-1. 범위 표시
- [ ] 스킬 발동 시 플레이어 주변 원형 범위 표시
- [ ] 반투명 보라색 (#8B5CF6) 영역
- [ ] 범위 크기 설정 (공격 범위보다 크게?)

### 4-2. 체력 흡수 메커니즘
- [ ] 범위 내 적 탐지 (플레이어, 더미)
- [ ] 적 HP 감소 (초당 X 데미지 또는 즉시?)
- [ ] 감소시킨 HP만큼 내 HP 회복
- [ ] 최대 HP 초과 불가

### 4-3. 지속 시간 vs 즉발
- [ ] 즉발형: 발동 시 한 번에 흡수
- [ ] 또는 지속형: 2~3초 동안 틱 데미지로 흡수
- [ ] (결정 필요)

### 4-4. 서버 동기화
- [ ] 텔레파시 발동 서버 전송
- [ ] 서버에서 범위 내 적 탐지 및 데미지/회복 계산
- [ ] 다른 플레이어에게 효과 브로드캐스트

### 테스트
- [ ] 보라색 범위가 정확히 표시되는지 확인
- [ ] 범위 내 적에게 데미지가 들어가는지 확인
- [ ] 데미지만큼 HP가 회복되는지 확인
- [ ] 쿨다운 15초 적용 확인
- [ ] 멀티플레이어에서 동기화 확인

---

## Phase 5: 통합 및 밸런스

### 5-1. 데미지 밸런스
- [ ] 레이저 빔 데미지 설정 (기본 공격보다 강하게)
- [ ] 순간이동 범위 데미지 설정 (기존 공격과 동일?)
- [ ] 텔레파시 흡수량 설정 (적당히)

### 5-2. 피격 피드백 통합
- [ ] 모든 스킬 데미지에 히트 플래시 적용
- [ ] 모든 스킬 데미지에 비네팅 적용 (로컬 플레이어)
- [ ] 넉백 적용 여부 결정 (레이저는 없음? 순간이동은 있음?)

### 5-3. 사운드 (선택)
- [ ] 각 스킬 사운드 이펙트 추가 (나중에)

### 테스트
- [ ] 전체 스킬 연속 사용 테스트
- [ ] 쿨다운 겹침 테스트
- [ ] 멀티플레이어 전투 테스트

---

## 기술 노트

### 히트스캔 구현 방법 (레이저 빔)
```javascript
// 선분과 원의 충돌 검사
function lineCircleIntersect(x1, y1, x2, y2, cx, cy, r) {
    // 선분: (x1,y1) → (x2,y2)
    // 원: 중심 (cx, cy), 반지름 r
    const dx = x2 - x1;
    const dy = y2 - y1;
    const fx = x1 - cx;
    const fy = y1 - cy;

    const a = dx*dx + dy*dy;
    const b = 2*(fx*dx + fy*dy);
    const c = fx*fx + fy*fy - r*r;

    const discriminant = b*b - 4*a*c;
    return discriminant >= 0;
}
```

### 스킬 클래스 예시
```javascript
class Skill {
    constructor(name, key, cooldown) {
        this.name = name;
        this.key = key;
        this.cooldown = cooldown; // ms
        this.lastUsedTime = 0;
    }

    isReady() {
        return Date.now() - this.lastUsedTime >= this.cooldown;
    }

    use() {
        if (!this.isReady()) return false;
        this.lastUsedTime = Date.now();
        return true;
    }

    getRemainingCooldown() {
        const elapsed = Date.now() - this.lastUsedTime;
        return Math.max(0, this.cooldown - elapsed);
    }
}
```

### 텔레파시 지속형 구현 (틱 데미지)
```javascript
// 매 프레임 업데이트에서
if (telepathyActive) {
    const elapsed = Date.now() - telepathyStartTime;
    if (elapsed >= telepathyDuration) {
        telepathyActive = false;
    } else {
        // 범위 내 적에게 틱 데미지
        const tickDamage = totalDamage * deltaTime / telepathyDuration;
        // 데미지 적용 및 회복
    }
}
```

---

## 완료

(아직 없음)
